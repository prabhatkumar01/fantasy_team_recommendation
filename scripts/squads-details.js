const squads = [
    {
        "squad": {
            "id": 22643,
            "objectId": 1413620,
            "teamId": 4343,
            "teamObjectId": 335974,
            "teamNameId": 4743,
            "teamName": "CSK",
            "teamImage": {
                "id": 313421,
                "objectId": 1241880,
                "slug": "chennai-super-kings-logo",
                "url": "/lsci/db/PICTURES/CMS/313400/313421.logo.png",
                "width": 500,
                "height": 500,
                "caption": "Chennai Super Kings logo",
                "longCaption": "Chennai Super Kings logo",
                "credit": null,
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "chennai-super-kings",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Chennai Super Kings Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "chennai-super-kings-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-20T05:49:52.000Z"
        }
    },
    {
        "squad": {
            "id": 22631,
            "objectId": 1413547,
            "teamId": 4344,
            "teamObjectId": 335975,
            "teamNameId": 7352,
            "teamName": "DC",
            "teamImage": {
                "id": 313422,
                "objectId": 1241881,
                "slug": "delhi-capitals-logo",
                "url": "/lsci/db/PICTURES/CMS/313400/313422.logo.png",
                "width": 500,
                "height": 500,
                "caption": "Delhi Capitals logo",
                "longCaption": "Delhi Capitals logo",
                "credit": null,
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "delhi-capitals",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Delhi Capitals Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "delhi-capitals-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T18:28:07.000Z"
        }
    },
    {
        "squad": {
            "id": 22639,
            "objectId": 1413572,
            "teamId": 6904,
            "teamObjectId": 1298769,
            "teamNameId": 7702,
            "teamName": "GT",
            "teamImage": {
                "id": 334707,
                "objectId": 1302048,
                "slug": "gujarat-titans-team-logo",
                "url": "/lsci/db/PICTURES/CMS/334700/334707.png",
                "width": 500,
                "height": 500,
                "caption": "Gujarat Titans team logo",
                "longCaption": "Gujarat Titans team logo",
                "credit": "Gujarat Titans",
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "gujarat-titans",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Gujarat Titans Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "gujarat-titans-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T19:46:03.000Z"
        }
    },
    {
        "squad": {
            "id": 22633,
            "objectId": 1413553,
            "teamId": 4341,
            "teamObjectId": 335971,
            "teamNameId": 4741,
            "teamName": "KKR",
            "teamImage": {
                "id": 313419,
                "objectId": 1241878,
                "slug": "kolkata-knight-riders-logo",
                "url": "/lsci/db/PICTURES/CMS/313400/313419.logo.png",
                "width": 500,
                "height": 500,
                "caption": "Kolkata Knight Riders logo",
                "longCaption": "Kolkata Knight Riders logo",
                "credit": null,
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "kolkata-knight-riders",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Kolkata Knight Riders Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "kolkata-knight-riders-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T18:25:27.000Z"
        }
    },
    {
        "squad": {
            "id": 22638,
            "objectId": 1413571,
            "teamId": 6903,
            "teamObjectId": 1298768,
            "teamNameId": 7701,
            "teamName": "LSG",
            "teamImage": {
                "id": 333885,
                "objectId": 1299425,
                "slug": "lucknow-ipl-team-logo",
                "url": "/lsci/db/PICTURES/CMS/333800/333885.png",
                "width": 500,
                "height": 500,
                "caption": "Lucknow IPL team logo",
                "longCaption": "Lucknow IPL team logo",
                "credit": "Unknown",
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "lucknow-super-giants",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Lucknow Super Giants Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "lucknow-super-giants-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T19:37:52.000Z"
        }
    },
    {
        "squad": {
            "id": 22634,
            "objectId": 1413556,
            "teamId": 4346,
            "teamObjectId": 335978,
            "teamNameId": 4746,
            "teamName": "MI",
            "teamImage": {
                "id": 344062,
                "objectId": 1328737,
                "slug": "mumbai-indians-2023-team-logo",
                "url": "/lsci/db/PICTURES/CMS/344000/344062.png",
                "width": 500,
                "height": 500,
                "caption": "Mumbai Indians 2023 team logo",
                "longCaption": "Mumbai Indians 2023 team logo",
                "credit": "Mumbai Indians",
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "mumbai-indians",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Mumbai Indians Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "mumbai-indians-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T18:45:53.000Z"
        }
    },
    {
        "squad": {
            "id": 22635,
            "objectId": 1413565,
            "teamId": 4342,
            "teamObjectId": 335973,
            "teamNameId": 7589,
            "teamName": "PBKS",
            "teamImage": {
                "id": 317003,
                "objectId": 1252156,
                "slug": "punjab-kings-team-logo",
                "url": "/lsci/db/PICTURES/CMS/317000/317003.png",
                "width": 500,
                "height": 500,
                "caption": "Punjab Kings team logo",
                "longCaption": "Punjab Kings team logo",
                "credit": "IPL",
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "punjab-kings",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Punjab Kings Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "punjab-kings-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T19:10:07.000Z"
        }
    },
    {
        "squad": {
            "id": 22636,
            "objectId": 1413568,
            "teamId": 4345,
            "teamObjectId": 335977,
            "teamNameId": 4745,
            "teamName": "RR",
            "teamImage": {
                "id": 313423,
                "objectId": 1241882,
                "slug": "rajasthan-royals-logo",
                "url": "/lsci/db/PICTURES/CMS/313400/313423.logo.png",
                "width": 500,
                "height": 500,
                "caption": "Rajasthan Royals logo",
                "longCaption": "Rajasthan Royals logo",
                "credit": null,
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "rajasthan-royals",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Rajasthan Royals Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "rajasthan-royals-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T19:22:16.000Z"
        }
    },
    {
        "squad": {
            "id": 22632,
            "objectId": 1413548,
            "teamId": 4340,
            "teamObjectId": 335970,
            "teamNameId": 4740,
            "teamName": "RCB",
            "teamImage": {
                "id": 378049,
                "objectId": 1425698,
                "slug": "rcb-2024-team-logo-without-the-background",
                "url": "/lsci/db/PICTURES/CMS/378000/378049.png",
                "width": 500,
                "height": 500,
                "caption": "RCB 2024 team logo (without the background)",
                "longCaption": "RCB 2024 team logo (without the background)",
                "credit": "RCB",
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "royal-challengers-bengaluru",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Royal Challengers Bangalore Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "royal-challengers-bangalore-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T18:19:44.000Z"
        }
    },
    {
        "squad": {
            "id": 22637,
            "objectId": 1413569,
            "teamId": 5143,
            "teamObjectId": 628333,
            "teamNameId": 5653,
            "teamName": "SRH",
            "teamImage": {
                "id": 313480,
                "objectId": 1241939,
                "slug": "sunrisers-hyderabad-logo",
                "url": "/lsci/db/PICTURES/CMS/313400/313480.logo.png",
                "width": 500,
                "height": 500,
                "caption": "Sunrisers Hyderabad logo",
                "longCaption": "Sunrisers Hyderabad logo",
                "credit": null,
                "photographer": null,
                "peerUrls": null
            },
            "teamSlug": "sunrisers-hyderabad",
            "seriesObjectId": 1410320,
            "seriesSlug": "indian-premier-league-2024",
            "title": "Sunrisers Hyderabad Squad",
            "objectMeta": {
                "id": 15940,
                "objectId": 1410320,
                "contentTypeId": 9
            },
            "slug": "sunrisers-hyderabad-squad",
            "announcedAt": "2023-12-19",
            "announcedOn": {
                "year": 2023,
                "month": 12,
                "date": 19
            },
            "modifiedAt": "2023-12-19T19:30:01.000Z"
        }
    }
]

const { parse } = require('json2csv');
const axios = require('axios');
const fs = require("fs");

const apiUrl = 'https://pp-hs-consumer-api.espncricinfo.com/v1/pages/series/squad/details?seriesId=1410320&squadId='; // Replace with your actual API URL
const headers = {
    'x-hsci-auth-key': '',  // Replace with your actual API key or auth token
    'Content-Type': 'application/json',
};


async function fetchSquads(id) {
    try {
        const response = await axios.get(`${apiUrl}${id}`, { headers });
       // console.log("resp", response.data);
        return response.data || [];
        
    } catch (error) {
        console.error(`Error fetching players for team ${id}:`, error.message);
        return [];
    }
}

const playersDetails  = [];

async function getData() {
    for (const squad of squads) {
        const id = squad.squad.objectId;
        const data = await fetchSquads(id);
        data.content.squadDetails.players.forEach((player) => {
            playersDetails.push({
                id: player.player.objectId,
                name: player.player.name,
                playingRoles: player.player.playingRoles.join(";"),
                teamId: data.content.squadDetails.squad.teamObjectId,
                teamName: data.content.squadDetails.squad.teamName
            })
        })
    }
    const csvData = parse(playersDetails);

    // Write CSV data to a file
    fs.writeFileSync('data/player.csv', csvData);
    console.log('Data has been written to player.csv');
}


getData();

    
